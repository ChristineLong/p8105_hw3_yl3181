---
title: "p8105_hw3_yl3181"
author: "Yuelin"
date: "October 13, 2018"
output: github_document
---

#Problem 1
```{r}
library(tidyverse)
library(p8105.datasets)

#Import and organize dataset including cleaning names, filter certain obs and change variable type
brfss = janitor::clean_names(brfss_smart2010) %>% 
        filter(topic == "Overall Health" & response == c("Excellent", "Poor")) %>% 
        mutate(response = factor(response, levels = c("Excellent","Poor")))

#Group datasets by years and locations for following analyses 
loc_count = group_by(brfss,year,locationabbr) %>% 
            summarise(loc_number = n())
```

+ In 2002, states observed at 7 locations is `r loc_count[loc_count$year==2002 & loc_count$loc_number == 7,]$locationabbr`;
(Comment: This means that the response rate for overall health topics are relatively high in these two states in 2002.)

+ A "spaghetti plot" that shows the number of locations in each state from 2002 to 2010:
```{r}
#Spaghetti plot
ggplot(data = loc_count,aes(x = year, y = loc_number, color = locationabbr)) + geom_line()
```

Comment: 
1. From the spaghetti plot, we can see that the response rate in Florida is very inconsistent. In 2007 and 2010, the number of locations in FL reached 40 or more, but in other years, the numbers of locations in FL all below 10;
2. In general, New Jersey has relatively more locations with response, especially in recent years; while Alaska has relatively less locations.

+ A table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of "Excellent" responses across locations in NY State:

```{r}
brfss %>%
  filter(locationabbr == "NY", year %in% c(2002,2006,2010)) %>% 
  group_by(year) %>% 
  mutate(sum_resp = sum(sample_size), prop = sample_size / sum_resp) %>% 
  filter(response == "Excellent") %>% 
  summarise(mean_prop_resp = mean(prop),sd_prop_resp = sd(prop) )
```
Comment: From the table, we can see that the proportion of excellent response for overall health topics are consistent with all these years (around 0.32), but the variance of the response increases at 2010. 

```{r}
# Group original data by year, state and response, then calculate the mean of proportions
brfss_group = janitor::clean_names(brfss_smart2010) %>% 
        filter(topic == "Overall Health") %>% 
        mutate(response = factor(response)) %>% 
        group_by(year,locationabbr, response) %>% 
        mutate(n_resp = sum(sample_size), prop_resp = sample_size / n_resp)

ggplot(brfss_group,aes(x = year, y = prop_resp, color = locationabbr)) + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + geom_line() + facet_grid(~response)
```



# Problem 2
```{r}
sum_insta = skimr::skim(instacart) %>%
            select(variable:stat,value) %>%
            filter(stat != "hist") %>%
            spread(key = stat,value = value)

knitr::kable(sum_insta)
```


```{r}
#Generate summary to describe types of variables
sum_insta_type = group_by(sum_insta,type) %>% 
                summarise(type_n = n())
```

+ The data structure is `r attributes(instacart)$class[3]`
+ The data includes `r nrow(instacart)` observations and `r ncol(instacart)` variables;
+ Among all these variables, `r as.numeric(sum_insta_type[1,2])` variables are `r as.character(sum_insta_type[1,1])`, and `r as.numeric(sum_insta_type[2,2])` variables are `r as.character(sum_insta_type[2,1])`; 
+ Some key variables are `r as.character(sum_insta[10:14,1])`;
+ Some examples of observations are as follows:
```{r echo=FALSE}
knitr::kable(head(instacart,3))
```

Answering questions:
```{r}
# Grouped data by aisle and generate total count of observations for the first question
group_insta_aisle = group_by(instacart,aisle) %>% 
                    summarise(n = n()) %>% 
                    arrange(desc(n))
```

+ How many aisles are there: `r nrow(distinct(instacart,aisle))`. Which aisles are the most items ordered from: `r as.character(group_insta_aisle[1,1])`
(Comment: Among all the 134 aisles, `r as.character(group_insta_aisle[1,1])` is the top-selling aisle.)

+ Make a plot that shows the number of items ordered in each aisle. Order aisles sensibly, and organize your plot so others can read it.
```{r}
ggplot(instacart,aes(x = aisle_id)) + geom_bar()
```

Comment: As we can see, orders for fresh vegetable and fresh fruits are far more than other aisles.

+ Make a table showing the most popular item in each of the aisles "baking ingredients", "dog food care", and "packaged vegetables fruits".
```{r}
# Grouped data by aisle and items, and generate total count of observations
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle,product_name) %>% 
  summarise(item_n = n()) %>% 
  filter(min_rank(desc(item_n))==1)
```
Comment: For baking ingredients, Light Brown Sugar is trending; For dog food care, Snack Sticks Chicken & Rice Recipe Dog Treats is trending; For packaged vegetables fruits, Organic Baby Spinach is trending.
