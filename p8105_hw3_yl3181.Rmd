---
title: "p8105_hw3_yl3181"
author: "Yuelin"
date: "October 13, 2018"
output: github_document
---

#Problem 1
```{r}
library(tidyverse)
library(p8105.datasets)

#Import and organize dataset including cleaning names, filter certain obs and change variable type
brfss = janitor::clean_names(brfss_smart2010) %>% 
        filter(topic == "Overall Health" & response == c("Excellent", "Poor")) %>% 
        mutate(response = factor(response, levels = c("Excellent","Poor")))

#Group datasets by years and locations for following analyses 
loc_count = group_by(brfss,year,locationabbr) %>% 
            summarise(loc_number = n())
```

+ In 2002, states observed at 7 locations is `r loc_count[loc_count$year==2002 & loc_count$loc_number == 7,]$locationabbr`;
(Comment: This means that the response rate for overall health topics are relatively high in these two states in 2002.)

+ A "spaghetti plot" that shows the number of locations in each state from 2002 to 2010:
```{r}
#Spaghetti plot
ggplot(data = loc_count,aes(x = year, y = loc_number, color = locationabbr)) + geom_line()
```

Comment: 
1. From the spaghetti plot, we can see that the response rate in Florida is very inconsistent. In 2007 and 2010, the number of locations in FL reached 40 or more, but in other years, the numbers of locations in FL all below 10;
2. In general, New Jersey has relatively more locations with response, especially in recent years; while Alaska has relatively less locations.

+ A table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of "Excellent" responses across locations in NY State:

```{r}
brfss %>%
  filter(locationabbr == "NY", year %in% c(2002,2006,2010)) %>% 
  group_by(year) %>% 
  mutate(sum_resp = sum(sample_size), prop = sample_size / sum_resp) %>% 
  filter(response == "Excellent") %>% 
  summarise(mean_prop_resp = mean(prop),sd_prop_resp = sd(prop) )
```
Comment: From the table, we can see that the proportion of excellent response for overall health topics are consistent with all these years (around 0.32), but the variance of the response increases at 2010. 

```{r}
# Group original data by year, state and response, then calculate the mean of proportions
brfss_group = janitor::clean_names(brfss_smart2010) %>% 
        filter(topic == "Overall Health") %>% 
        mutate(response = factor(response)) %>% 
        group_by(year,locationabbr, response) %>% 
        mutate(n_resp = sum(sample_size), prop_resp = sample_size / n_resp)

ggplot(brfss_group,aes(x = year, y = prop_resp, color = locationabbr)) + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + geom_line() + facet_grid(~response)
```
